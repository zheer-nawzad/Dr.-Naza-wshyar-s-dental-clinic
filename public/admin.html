<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ | Ú©Ù„ÛŒÙ†ÛŒÚ©ÛŒ Ø¯Ø¯Ø§Ù†ÛŒ Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#1a5653;--primary-light:#2a7a76;--primary-dark:#0f3634;--accent:#c9a962;--cream:#faf8f3;--cream-dark:#f0ece3;--text:#2d3436;--text-light:#636e72;--success:#00b894;--warning:#fdcb6e;--danger:#d63031;--shadow:0 4px 20px rgba(26,86,83,0.08)}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans Arabic',sans-serif;background:var(--cream);color:var(--text);min-height:100vh}
        body.ltr{direction:ltr}body.rtl{direction:rtl}
        .hidden{display:none!important}
        .lang-switcher{display:flex;gap:0.25rem;background:rgba(255,255,255,0.1);padding:0.25rem;border-radius:8px}
        .lang-btn{padding:0.35rem 0.5rem;border:none;background:transparent;border-radius:6px;cursor:pointer;font-size:0.7rem;font-weight:500;font-family:inherit;color:white;opacity:0.7}
        .lang-btn:hover{opacity:1;background:rgba(255,255,255,0.1)}.lang-btn.active{background:rgba(255,255,255,0.2);opacity:1}
        .sidebar{position:fixed;top:0;right:0;width:260px;height:100vh;background:linear-gradient(180deg,var(--primary-dark) 0%,var(--primary) 100%);color:white;padding:1.5rem 0;z-index:100}
        body.ltr .sidebar{right:auto;left:0}
        .sidebar-header{padding:0 1.5rem 1.5rem;border-bottom:1px solid rgba(255,255,255,0.1);margin-bottom:1rem}
        .sidebar-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem}
        .sidebar-logo{display:flex;align-items:center;gap:0.75rem}
        .sidebar-logo-icon{width:45px;height:45px;background:var(--accent);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem}
        .sidebar-logo h1{font-size:1rem;font-weight:600}.sidebar-logo p{font-size:0.75rem;opacity:0.7}
        .sidebar-nav{padding:0 0.75rem}
        .nav-item{display:flex;align-items:center;gap:0.75rem;padding:0.85rem 1rem;border-radius:12px;cursor:pointer;font-size:0.9rem;margin-bottom:0.25rem}
        .nav-item:hover{background:rgba(255,255,255,0.1)}.nav-item.active{background:rgba(201,169,98,0.2);color:#dfc68a}
        .nav-item span:first-child{font-size:1.1rem;width:28px}
        .sidebar-footer{position:absolute;bottom:0;left:0;right:0;padding:1rem 1.5rem;border-top:1px solid rgba(255,255,255,0.1)}
        .admin-info{display:flex;align-items:center;gap:0.75rem;margin-bottom:0.75rem}
        .admin-avatar{width:40px;height:40px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--primary-dark)}
        .btn-logout{width:100%;padding:0.6rem;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:10px;color:white;cursor:pointer;font-family:inherit;font-size:0.85rem}
        .btn-logout:hover{background:rgba(214,48,49,0.3);border-color:var(--danger)}
        .main-content{margin-right:260px;padding:1.5rem;min-height:100vh}
        body.ltr .main-content{margin-right:0;margin-left:260px}
        .login-container{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%)}
        .login-card{background:white;padding:2.5rem;border-radius:24px;width:100%;max-width:400px;box-shadow:var(--shadow)}
        .login-header{text-align:center;margin-bottom:2rem}
        .login-top{display:flex;justify-content:flex-end;margin-bottom:1rem}
        .login-header .logo-icon{width:70px;height:70px;background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem;margin:0 auto 1rem}
        .login-header h1{color:var(--primary);font-size:1.3rem;margin-bottom:0.3rem}.login-header p{color:var(--text-light);font-size:0.9rem}
        .login-lang{display:flex;gap:0.25rem;background:var(--cream);padding:0.25rem;border-radius:8px}
        .login-lang .lang-btn{color:var(--text);opacity:0.6}
        .login-lang .lang-btn.active{background:var(--primary);color:white;opacity:1}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
        .page-title{font-size:1.3rem;color:var(--primary);display:flex;align-items:center;gap:0.5rem}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}
        .stat-card{background:white;border-radius:16px;padding:1.25rem;box-shadow:var(--shadow)}
        .stat-icon{width:45px;height:45px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;margin-bottom:0.75rem}
        .stat-icon.primary{background:rgba(26,86,83,0.1)}.stat-icon.success{background:rgba(0,184,148,0.1)}.stat-icon.warning{background:rgba(253,203,110,0.2)}.stat-icon.accent{background:rgba(201,169,98,0.15)}
        .stat-value{font-size:1.75rem;font-weight:700;color:var(--primary)}.stat-label{color:var(--text-light);font-size:0.85rem}
        .card{background:white;border-radius:16px;box-shadow:var(--shadow);padding:1.25rem;margin-bottom:1rem}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:2px solid var(--cream)}
        .card-title{font-size:1rem;color:var(--primary);display:flex;align-items:center;gap:0.5rem}
        .form-group{margin-bottom:1rem}.form-group label{display:block;margin-bottom:0.4rem;font-weight:500;font-size:0.85rem}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:0.75rem 1rem;border:2px solid var(--cream-dark);border-radius:10px;font-size:0.9rem;font-family:inherit;background:var(--cream)}
        .form-group input:focus,.form-group select:focus{outline:none;border-color:var(--primary-light);background:white}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:0.75rem}
        .btn{padding:0.75rem 1.25rem;border:none;border-radius:10px;font-size:0.9rem;font-weight:600;cursor:pointer;font-family:inherit;display:inline-flex;align-items:center;justify-content:center;gap:0.4rem}
        .btn-primary{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white}
        .btn-secondary{background:var(--cream);color:var(--primary);border:2px solid var(--cream-dark)}
        .btn-success{background:var(--success);color:white}.btn-danger{background:var(--danger);color:white}.btn-warning{background:var(--warning);color:var(--text)}
        .btn-sm{padding:0.5rem 0.75rem;font-size:0.8rem}.btn-icon{width:32px;height:32px;padding:0}
        table{width:100%;border-collapse:collapse}
        th,td{padding:0.75rem;text-align:right;border-bottom:1px solid var(--cream-dark);font-size:0.9rem}
        body.ltr th,body.ltr td{text-align:left}
        th{font-weight:600;color:var(--text-light);font-size:0.8rem;background:var(--cream)}
        tr:hover td{background:rgba(26,86,83,0.02)}
        .badge{display:inline-flex;padding:0.3rem 0.6rem;border-radius:15px;font-size:0.75rem;font-weight:500}
        .badge-pending{background:rgba(253,203,110,0.2);color:#d68f00}
        .badge-confirmed{background:rgba(0,184,148,0.15);color:var(--success)}
        .badge-completed{background:rgba(26,86,83,0.1);color:var(--primary)}
        .badge-cancelled{background:rgba(214,48,49,0.1);color:var(--danger)}
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:all 0.3s}
        .modal-overlay.active{opacity:1;visibility:visible}
        .modal{background:white;border-radius:20px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto}
        .modal-header{padding:1.25rem;border-bottom:2px solid var(--cream);display:flex;justify-content:space-between;align-items:center}
        .modal-title{font-size:1.1rem;color:var(--primary)}
        .modal-close{width:32px;height:32px;border:none;background:var(--cream);border-radius:8px;cursor:pointer;font-size:1.2rem}
        .modal-body{padding:1.25rem}.modal-footer{padding:1rem 1.25rem;border-top:2px solid var(--cream);display:flex;gap:0.5rem;justify-content:flex-end}
        .filters{display:flex;gap:0.75rem;flex-wrap:wrap;margin-bottom:1rem}
        .filters input,.filters select{padding:0.6rem 1rem;border:2px solid var(--cream-dark);border-radius:10px;font-family:inherit;background:white}
        .apt-item{display:flex;align-items:center;gap:1rem;padding:0.75rem;background:var(--cream);border-radius:12px;margin-bottom:0.5rem}
        .apt-date{text-align:center;background:var(--primary);color:white;padding:0.5rem 0.75rem;border-radius:10px;min-width:80px;font-size:0.85rem;font-weight:600}
        .apt-details{flex:1}.apt-name{font-weight:600;font-size:0.9rem}.apt-treatment{color:var(--text-light);font-size:0.8rem}
        .apt-actions{display:flex;gap:0.3rem}
        .loading{text-align:center;padding:2rem;color:var(--text-light)}
        .spinner{width:25px;height:25px;border:3px solid var(--cream-dark);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;display:inline-block;margin:0 0.5rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        @media(max-width:768px){.sidebar{width:100%;height:auto;position:relative}.main-content{margin:0!important}.form-row{grid-template-columns:1fr}}
    </style>
</head>
<body class="rtl">
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-top">
                <div class="login-lang">
                    <button class="lang-btn active" onclick="setLanguage('ku')">Ú©ÙˆØ±Ø¯ÛŒ</button>
                    <button class="lang-btn" onclick="setLanguage('en')">EN</button>
                    <button class="lang-btn" onclick="setLanguage('ar')">Ø¹Ø±Ø¨ÙŠ</button>
                </div>
            </div>
            <div class="login-header"><div class="logo-icon">ğŸ¦·</div><h1 data-i18n="adminTitle">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ Ú©Ù„ÛŒÙ†ÛŒÚ©</h1><p data-i18n="adminSubtitle">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û† Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†</p></div>
            <div class="form-group"><label data-i18n="username">Ù†Ø§ÙˆÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±</label><input type="text" id="loginUsername" placeholder="admin" dir="ltr"></div>
            <div class="form-group"><label data-i18n="password">ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ</label><input type="password" id="loginPassword" dir="ltr"></div>
            <button class="btn btn-primary" onclick="adminLogin()" style="width:100%" data-i18n="loginBtn">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
        </div>
    </div>

    <div id="adminDashboard" class="hidden">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-top">
                    <div class="sidebar-logo"><div class="sidebar-logo-icon">ğŸ¦·</div><div><h1 data-i18n="doctorName">Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±</h1><p data-i18n="management">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ</p></div></div>
                    <div class="lang-switcher">
                        <button class="lang-btn active" onclick="setLanguage('ku')">Ú©Ùˆ</button>
                        <button class="lang-btn" onclick="setLanguage('en')">EN</button>
                        <button class="lang-btn" onclick="setLanguage('ar')">Ø¹Ø±</button>
                    </div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" onclick="showPage('dashboard')"><span>ğŸ“Š</span><span data-i18n="dashboard">Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯</span></div>
                <div class="nav-item" onclick="showPage('appointments')"><span>ğŸ“…</span><span data-i18n="appointments">Ù†Û†Ø±Û•Ú©Ø§Ù†</span></div>
                <div class="nav-item" onclick="showPage('patients')"><span>ğŸ‘¥</span><span data-i18n="patients">Ù†Û•Ø®Û†Ø´Û•Ú©Ø§Ù†</span></div>
                <div class="nav-item" onclick="showPage('schedule')"><span>ğŸ•</span><span data-i18n="blockTime">Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§Øª</span></div>
                <div class="nav-item" onclick="showPage('settings')"><span>âš™ï¸</span><span data-i18n="settings">Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†</span></div>
            </nav>
            <div class="sidebar-footer">
                <div class="admin-info"><div class="admin-avatar" id="adminAvatar">Ù†</div><div><div id="adminNameDisplay" style="font-size:0.9rem;font-weight:600">Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±</div><div style="font-size:0.75rem;opacity:0.7" data-i18n="adminRole">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±</div></div></div>
                <button class="btn-logout" onclick="adminLogout()" data-i18n="logout">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
            </div>
        </aside>

        <main class="main-content">
            <div id="dashboardPage">
                <div class="page-header"><h1 class="page-title">ğŸ“Š <span data-i18n="dashboard">Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯</span></h1><button class="btn btn-primary" onclick="openNewAppointmentModal()">+ <span data-i18n="newAppointment">Ù†Û†Ø±Û•ÛŒ Ù†ÙˆÛ</span></button></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon primary">ğŸ“…</div><div class="stat-value" id="statToday">0</div><div class="stat-label" data-i18n="todayAppts">Ù†Û†Ø±Û•ÛŒ Ø¦Û•Ù…Ú•Û†</div></div>
                    <div class="stat-card"><div class="stat-icon warning">â³</div><div class="stat-value" id="statPending">0</div><div class="stat-label" data-i18n="pendingAppts">Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒ Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</div></div>
                    <div class="stat-card"><div class="stat-icon success">âœ“</div><div class="stat-value" id="statWeek">0</div><div class="stat-label" data-i18n="weekCompleted">ØªÛ•ÙˆØ§ÙˆØ¨ÙˆÙˆ (Ø¦Û•Ù… Ù‡Û•ÙØªÛ•ÛŒÛ•)</div></div>
                    <div class="stat-card"><div class="stat-icon accent">ğŸ‘¥</div><div class="stat-value" id="statPatients">0</div><div class="stat-label" data-i18n="totalPatients">Ú©Û†ÛŒ Ù†Û•Ø®Û†Ø´Û•Ú©Ø§Ù†</div></div>
                </div>
                <div class="card"><div class="card-header"><h2 class="card-title">ğŸ“‹ <span data-i18n="upcomingAppts">Ù†Û†Ø±Û• Ø¯Ø§Ù‡Ø§ØªÙˆÙˆÛ•Ú©Ø§Ù†</span></h2></div><div id="upcomingList"><div class="loading"><span class="spinner"></span></div></div></div>
            </div>

            <div id="appointmentsPage" class="hidden">
                <div class="page-header"><h1 class="page-title">ğŸ“… <span data-i18n="appointments">Ù†Û†Ø±Û•Ú©Ø§Ù†</span></h1><button class="btn btn-primary" onclick="openNewAppointmentModal()">+ <span data-i18n="newAppointment">Ù†Û†Ø±Û•ÛŒ Ù†ÙˆÛ</span></button></div>
                <div class="filters">
                    <input type="date" id="filterDate" onchange="loadAppointments()">
                    <select id="filterStatus" onchange="loadAppointments()"><option value="" data-i18n="allStatus">Ù‡Û•Ù…ÙˆÙˆ Ø¨Ø§Ø±Û•Ú©Ø§Ù†</option><option value="pending">Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†</option><option value="confirmed">Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø§ÙˆÛ•</option><option value="completed">ØªÛ•ÙˆØ§ÙˆØ¨ÙˆÙˆ</option><option value="cancelled">Ù‡Û•ÚµÙˆÛ•Ø´Ø§ÙˆÛ•ØªÛ•ÙˆÛ•</option></select>
                    <button class="btn btn-secondary btn-sm" onclick="clearFilters()" data-i18n="clear">Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                </div>
                <div class="card"><table><thead><tr><th data-i18n="date">Ø¨Û•Ø±ÙˆØ§Ø±</th><th data-i18n="time">Ú©Ø§Øª</th><th data-i18n="patient">Ù†Û•Ø®Û†Ø´</th><th data-i18n="phone">Ú˜Ù…Ø§Ø±Û•</th><th data-i18n="treatment">Ú†Ø§Ø±Û•Ø³Û•Ø±</th><th data-i18n="status">Ø¨Ø§Ø±</th><th data-i18n="actions">Ú©Ø±Ø¯Ø§Ø±</th></tr></thead><tbody id="appointmentsTable"></tbody></table></div>
            </div>

            <div id="patientsPage" class="hidden">
                <div class="page-header"><h1 class="page-title">ğŸ‘¥ <span data-i18n="patients">Ù†Û•Ø®Û†Ø´Û•Ú©Ø§Ù†</span></h1></div>
                <div class="card"><table><thead><tr><th data-i18n="name">Ù†Ø§Ùˆ</th><th data-i18n="phone">Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„</th><th data-i18n="totalAppts">Ú©Û†ÛŒ Ù†Û†Ø±Û•</th><th data-i18n="completed">ØªÛ•ÙˆØ§ÙˆØ¨ÙˆÙˆ</th><th data-i18n="registered">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§Ùˆ</th></tr></thead><tbody id="patientsTable"></tbody></table></div>
            </div>

            <div id="schedulePage" class="hidden">
                <div class="page-header"><h1 class="page-title">ğŸ• <span data-i18n="blockTime">Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§Øª</span></h1><button class="btn btn-primary" onclick="openBlockSlotModal()">+ <span data-i18n="newBlock">Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§ØªÛŒ Ù†ÙˆÛ</span></button></div>
                <div class="card"><div class="card-header"><h2 class="card-title" data-i18n="blockedSlots">Ú©Ø§ØªÛ• Ø¨Ù„Û†Ú©Ú©Ø±Ø§ÙˆÛ•Ú©Ø§Ù†</h2></div><table><thead><tr><th data-i18n="date">Ø¨Û•Ø±ÙˆØ§Ø±</th><th data-i18n="time">Ú©Ø§Øª</th><th data-i18n="reason">Ù‡Û†Ú©Ø§Ø±</th><th data-i18n="actions">Ú©Ø±Ø¯Ø§Ø±</th></tr></thead><tbody id="blockedSlotsTable"></tbody></table></div>
            </div>

            <div id="settingsPage" class="hidden">
                <div class="page-header"><h1 class="page-title">âš™ï¸ <span data-i18n="settings">Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†</span></h1></div>
                <div class="card"><div class="card-header"><h2 class="card-title" data-i18n="changePassword">Ú¯Û†Ú•ÛŒÙ†ÛŒ ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ</h2></div>
                    <div style="max-width:400px">
                        <div class="form-group"><label data-i18n="currentPassword">ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ø¦ÛØ³ØªØ§</label><input type="password" id="currentPassword" dir="ltr"></div>
                        <div class="form-group"><label data-i18n="newPassword">ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ù†ÙˆÛ</label><input type="password" id="newPassword" dir="ltr"></div>
                        <button class="btn btn-primary" onclick="changePassword()" data-i18n="change">Ú¯Û†Ú•ÛŒÙ†</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="appointmentModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title" data-i18n="addNewAppt">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù†Û†Ø±Û•ÛŒ Ù†ÙˆÛ</h2><button class="modal-close" onclick="closeModal('appointmentModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-row"><div class="form-group"><label data-i18n="patientName">Ù†Ø§ÙˆÛŒ Ù†Û•Ø®Û†Ø´</label><input type="text" id="aptPatientName"></div><div class="form-group"><label data-i18n="phone">Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„</label><input type="tel" id="aptPatientPhone" dir="ltr"></div></div>
                <div class="form-group"><label data-i18n="treatment">Ú†Ø§Ø±Û•Ø³Û•Ø±</label><select id="aptTreatment"></select></div>
                <div class="form-row"><div class="form-group"><label data-i18n="date">Ø¨Û•Ø±ÙˆØ§Ø±</label><input type="date" id="aptDate" onchange="loadAvailableSlots()"></div><div class="form-group"><label data-i18n="time">Ú©Ø§Øª</label><select id="aptTime"><option value="">Ø³Û•Ø±Û•ØªØ§ Ø¨Û•Ø±ÙˆØ§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option></select></div></div>
                <div class="form-group"><label data-i18n="status">Ø¨Ø§Ø±</label><select id="aptStatus"><option value="confirmed">Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø§ÙˆÛ•</option><option value="pending">Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†</option></select></div>
                <div class="form-group"><label data-i18n="notes">ØªÛØ¨ÛŒÙ†ÛŒ</label><textarea id="aptNotes" rows="2"></textarea></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('appointmentModal')" data-i18n="close">Ø¯Ø§Ø®Ø³ØªÙ†</button><button class="btn btn-primary" onclick="createAppointment()" data-i18n="add">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="blockSlotModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title" data-i18n="blockTime">Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§Øª</h2><button class="modal-close" onclick="closeModal('blockSlotModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label data-i18n="date">Ø¨Û•Ø±ÙˆØ§Ø±</label><input type="date" id="blockDate"></div>
                <div class="form-row"><div class="form-group"><label data-i18n="startTime">Ú©Ø§ØªÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ©</label><input type="time" id="blockStartTime" value="13:00"></div><div class="form-group"><label data-i18n="endTime">Ú©Ø§ØªÛŒ Ú©Û†ØªØ§ÛŒÛŒ</label><input type="time" id="blockEndTime" value="19:00"></div></div>
                <div class="form-group"><label data-i18n="reason">Ù‡Û†Ú©Ø§Ø±</label><input type="text" id="blockReason"></div>
            </div>
            <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('blockSlotModal')" data-i18n="close">Ø¯Ø§Ø®Ø³ØªÙ†</button><button class="btn btn-primary" onclick="blockSlot()" data-i18n="block">Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†</button></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
const T={
    ku:{doctorName:'Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±',management:'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ',adminTitle:'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ Ú©Ù„ÛŒÙ†ÛŒÚ©',adminSubtitle:'Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û† Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†',username:'Ù†Ø§ÙˆÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±',password:'ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ',loginBtn:'Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•',logout:'Ø¯Û•Ø±Ú†ÙˆÙˆÙ†',adminRole:'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±',
        dashboard:'Ø¯Ø§Ø´Ø¨Û†Ø±Ø¯',appointments:'Ù†Û†Ø±Û•Ú©Ø§Ù†',patients:'Ù†Û•Ø®Û†Ø´Û•Ú©Ø§Ù†',blockTime:'Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§Øª',settings:'Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†',
        newAppointment:'Ù†Û†Ø±Û•ÛŒ Ù†ÙˆÛ',todayAppts:'Ù†Û†Ø±Û•ÛŒ Ø¦Û•Ù…Ú•Û†',pendingAppts:'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒ Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•',weekCompleted:'ØªÛ•ÙˆØ§ÙˆØ¨ÙˆÙˆ (Ø¦Û•Ù… Ù‡Û•ÙØªÛ•ÛŒÛ•)',totalPatients:'Ú©Û†ÛŒ Ù†Û•Ø®Û†Ø´Û•Ú©Ø§Ù†',upcomingAppts:'Ù†Û†Ø±Û• Ø¯Ø§Ù‡Ø§ØªÙˆÙˆÛ•Ú©Ø§Ù†',
        date:'Ø¨Û•Ø±ÙˆØ§Ø±',time:'Ú©Ø§Øª',patient:'Ù†Û•Ø®Û†Ø´',phone:'Ú˜Ù…Ø§Ø±Û•',treatment:'Ú†Ø§Ø±Û•Ø³Û•Ø±',status:'Ø¨Ø§Ø±',actions:'Ú©Ø±Ø¯Ø§Ø±',name:'Ù†Ø§Ùˆ',totalAppts:'Ú©Û†ÛŒ Ù†Û†Ø±Û•',completed:'ØªÛ•ÙˆØ§ÙˆØ¨ÙˆÙˆ',registered:'ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§Ùˆ',
        allStatus:'Ù‡Û•Ù…ÙˆÙˆ Ø¨Ø§Ø±Û•Ú©Ø§Ù†',clear:'Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•',newBlock:'Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§ØªÛŒ Ù†ÙˆÛ',blockedSlots:'Ú©Ø§ØªÛ• Ø¨Ù„Û†Ú©Ú©Ø±Ø§ÙˆÛ•Ú©Ø§Ù†',reason:'Ù‡Û†Ú©Ø§Ø±',startTime:'Ú©Ø§ØªÛŒ Ø¯Û•Ø³ØªÙ¾ÛÚ©',endTime:'Ú©Ø§ØªÛŒ Ú©Û†ØªØ§ÛŒÛŒ',
        changePassword:'Ú¯Û†Ú•ÛŒÙ†ÛŒ ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ',currentPassword:'ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ø¦ÛØ³ØªØ§',newPassword:'ÙˆØ´Û•ÛŒ Ù†Ù‡ÛÙ†ÛŒ Ù†ÙˆÛ',change:'Ú¯Û†Ú•ÛŒÙ†',
        addNewAppt:'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù†Û†Ø±Û•ÛŒ Ù†ÙˆÛ',patientName:'Ù†Ø§ÙˆÛŒ Ù†Û•Ø®Û†Ø´',notes:'ØªÛØ¨ÛŒÙ†ÛŒ',close:'Ø¯Ø§Ø®Ø³ØªÙ†',add:'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†',block:'Ø¨Ù„Û†Ú©Ú©Ø±Ø¯Ù†',
        pending:'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†',confirmed:'Ù¾Ø´ØªÚ•Ø§Ø³Øª',complete:'ØªÛ•ÙˆØ§Ùˆ',cancelled:'Ù‡Û•ÚµÙˆÛ•Ø´Ø§',
        treatments:{1:'Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Ø¦Ø§Ø³Ø§ÛŒÛŒ',2:'Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Ø¯Ø§Ù†',3:'Ù¾Ú•Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Ø¯Ø§Ù†',4:'Ù„ÛÚ©Ø±Ø¯Ù†ÛŒ Ø¯Ø¯Ø§Ù†',5:'Ø¯Û•Ø±Ù…Ø§Ù†Ú©Ø±Ø¯Ù†ÛŒ Ú•Û•Ú¯ÛŒ Ø¯Ø¯Ø§Ù†',6:'ØªØ§Ø¬ÛŒ Ø¯Ø¯Ø§Ù†',7:'Ø³Ù¾ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Ø¯Ø§Ù†',8:'ÙˆÛÙ†Û•ÛŒ ØªÛŒØ´Ú©ÛŒ Ø¯Ø¯Ø§Ù†',9:'Ú•Ø§ÙˆÛÚ˜ÛŒ Ú•ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ø¯Ø¯Ø§Ù†',10:'Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ ÙØ±ÛŒØ§Ú©Û•ÙˆØªÙ†',11:'Ú•Ø§ÙˆÛÚ˜ÛŒ Ú†Ø§Ù†Ø¯Ù†ÛŒ Ø¯Ø¯Ø§Ù†',12:'Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ Ø¯ÚµÚ©'}},
    en:{doctorName:'Dr. Naza Wshyar',management:'Administration',adminTitle:'Clinic Administration',adminSubtitle:'Login to manage',username:'Username',password:'Password',loginBtn:'Login',logout:'Logout',adminRole:'Admin',
        dashboard:'Dashboard',appointments:'Appointments',patients:'Patients',blockTime:'Block Time',settings:'Settings',
        newAppointment:'New Appointment',todayAppts:"Today's Appointments",pendingAppts:'Pending Confirmation',weekCompleted:'Completed (This Week)',totalPatients:'Total Patients',upcomingAppts:'Upcoming Appointments',
        date:'Date',time:'Time',patient:'Patient',phone:'Phone',treatment:'Treatment',status:'Status',actions:'Actions',name:'Name',totalAppts:'Total Appts',completed:'Completed',registered:'Registered',
        allStatus:'All Statuses',clear:'Clear',newBlock:'New Block',blockedSlots:'Blocked Slots',reason:'Reason',startTime:'Start Time',endTime:'End Time',
        changePassword:'Change Password',currentPassword:'Current Password',newPassword:'New Password',change:'Change',
        addNewAppt:'Add New Appointment',patientName:'Patient Name',notes:'Notes',close:'Close',add:'Add',block:'Block',
        pending:'Pending',confirmed:'Confirmed',complete:'Complete',cancelled:'Cancelled',
        treatments:{1:'Regular Checkup',2:'Teeth Cleaning',3:'Tooth Filling',4:'Tooth Extraction',5:'Root Canal',6:'Dental Crown',7:'Teeth Whitening',8:'Dental X-Ray',9:'Orthodontic Consultation',10:'Emergency Treatment',11:'Dental Implant Consultation',12:'Gum Treatment'}},
    ar:{doctorName:'Ø¯. Ù†Ø§Ø²Ù‡ ÙˆØ´ÛŒØ§Ø±',management:'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',adminTitle:'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©',adminSubtitle:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©',username:'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',password:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',loginBtn:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',logout:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',adminRole:'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„',
        dashboard:'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',appointments:'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯',patients:'Ø§Ù„Ù…Ø±Ø¶Ù‰',blockTime:'Ø­Ø¬Ø¨ Ø§Ù„ÙˆÙ‚Øª',settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
        newAppointment:'Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯',todayAppts:'Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…',pendingAppts:'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯',weekCompleted:'Ù…ÙƒØªÙ…Ù„ (Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹)',totalPatients:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø¶Ù‰',upcomingAppts:'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©',
        date:'Ø§Ù„ØªØ§Ø±ÙŠØ®',time:'Ø§Ù„ÙˆÙ‚Øª',patient:'Ø§Ù„Ù…Ø±ÙŠØ¶',phone:'Ø§Ù„Ù‡Ø§ØªÙ',treatment:'Ø§Ù„Ø¹Ù„Ø§Ø¬',status:'Ø§Ù„Ø­Ø§Ù„Ø©',actions:'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª',name:'Ø§Ù„Ø§Ø³Ù…',totalAppts:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯',completed:'Ù…ÙƒØªÙ…Ù„',registered:'Ù…Ø³Ø¬Ù„',
        allStatus:'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª',clear:'Ù…Ø³Ø­',newBlock:'Ø­Ø¬Ø¨ Ø¬Ø¯ÙŠØ¯',blockedSlots:'Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø­Ø¬ÙˆØ¨Ø©',reason:'Ø§Ù„Ø³Ø¨Ø¨',startTime:'ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©',endTime:'ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©',
        changePassword:'ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',currentPassword:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©',newPassword:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©',change:'ØªØºÙŠÙŠØ±',
        addNewAppt:'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯',patientName:'Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶',notes:'Ù…Ù„Ø§Ø­Ø¸Ø§Øª',close:'Ø¥ØºÙ„Ø§Ù‚',add:'Ø¥Ø¶Ø§ÙØ©',block:'Ø­Ø¬Ø¨',
        pending:'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',confirmed:'Ù…Ø¤ÙƒØ¯',complete:'Ù…ÙƒØªÙ…Ù„',cancelled:'Ù…Ù„ØºÙŠ',
        treatments:{1:'ÙØ­Øµ Ø¹Ø§Ù…',2:'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',3:'Ø­Ø´Ùˆ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',4:'Ø®Ù„Ø¹ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',5:'Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¹ØµØ¨',6:'ØªØ§Ø¬ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',7:'ØªØ¨ÙŠÙŠØ¶ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',8:'Ø£Ø´Ø¹Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†',9:'Ø§Ø³ØªØ´Ø§Ø±Ø© ØªÙ‚ÙˆÙŠÙ…',10:'Ø¹Ù„Ø§Ø¬ Ø·ÙˆØ§Ø±Ø¦',11:'Ø§Ø³ØªØ´Ø§Ø±Ø© Ø²Ø±Ø§Ø¹Ø©',12:'Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù„Ø«Ø©'}}
};

let lang='ku',treatments=[];
const socket=io();

function t(k){return T[lang][k]||k}
function formatDate(ds){if(!ds)return'-';const d=new Date(ds);return String(d.getDate()).padStart(2,'0')+'.'+String(d.getMonth()+1).padStart(2,'0')+'.'+d.getFullYear();}

function setLanguage(l){
    lang=l;localStorage.setItem('admin-lang',l);
    document.body.classList.remove('ltr','rtl');
    document.body.classList.add(l==='en'?'ltr':'rtl');
    document.documentElement.dir=l==='en'?'ltr':'rtl';
    document.querySelectorAll('.lang-btn').forEach(b=>{
        const txt=b.textContent.trim();
        b.classList.toggle('active',(l==='ku'&&(txt==='Ú©ÙˆØ±Ø¯ÛŒ'||txt==='Ú©Ùˆ'))||(l==='en'&&(txt==='English'||txt==='EN'))||(l==='ar'&&(txt==='Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'||txt==='Ø¹Ø±Ø¨ÙŠ'||txt==='Ø¹Ø±')));
    });
    document.querySelectorAll('[data-i18n]').forEach(el=>el.textContent=t(el.dataset.i18n));
    if(treatments.length)populateTreatmentSelect();
}

document.addEventListener('DOMContentLoaded',()=>{setLanguage(localStorage.getItem('admin-lang')||'ku');checkAuth();});

async function checkAuth(){const r=await fetch('/api/admin/check');const d=await r.json();if(d.authenticated)showDashboard(d.name);}

async function adminLogin(){
    const u=document.getElementById('loginUsername').value,p=document.getElementById('loginPassword').value;
    const r=await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
    const d=await r.json();
    if(d.success)showDashboard(d.name);else alert(d.error||'Error');
}

async function adminLogout(){await fetch('/api/admin/logout',{method:'POST'});document.getElementById('loginPage').classList.remove('hidden');document.getElementById('adminDashboard').classList.add('hidden');}

async function showDashboard(name){
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('adminDashboard').classList.remove('hidden');
    document.getElementById('adminNameDisplay').textContent=name;
    document.getElementById('adminAvatar').textContent=name[0];
    await loadTreatments();loadStats();
}

async function loadTreatments(){const r=await fetch('/api/treatments');treatments=await r.json();populateTreatmentSelect();}

function populateTreatmentSelect(){document.getElementById('aptTreatment').innerHTML=treatments.map(tr=>`<option value="${tr.id}">${t('treatments')[tr.id]||tr.name_ku} (${tr.duration} min)</option>`).join('');}

async function loadStats(){
    const r=await fetch('/api/admin/stats');const d=await r.json();
    document.getElementById('statToday').textContent=d.todayAppointments;
    document.getElementById('statPending').textContent=d.pendingAppointments;
    document.getElementById('statWeek').textContent=d.thisWeekCompleted;
    document.getElementById('statPatients').textContent=d.totalPatients;
    renderUpcoming(d.upcomingAppointments);
}

function renderUpcoming(apts){
    if(!apts.length){document.getElementById('upcomingList').innerHTML='<div style="text-align:center;padding:2rem;color:var(--text-light)">No appointments</div>';return;}
    document.getElementById('upcomingList').innerHTML=apts.map(a=>`<div class="apt-item"><div class="apt-date">${formatDate(a.date)}</div><div class="apt-details"><div class="apt-name">${a.patient_name}</div><div class="apt-treatment">${t('treatments')[a.treatment_id]||a.treatment?.name_ku}</div></div><div style="font-size:0.8rem;color:var(--primary)">${a.start_time}-${a.end_time}</div><span class="badge badge-${a.status}">${t(a.status)}</span><div class="apt-actions">${a.status==='pending'?`<button class="btn btn-success btn-sm btn-icon" onclick="updateStatus(${a.id},'confirmed')">âœ“</button>`:''} ${a.status==='confirmed'?`<button class="btn btn-primary btn-sm btn-icon" onclick="updateStatus(${a.id},'completed')">âœ“</button>`:''}<button class="btn btn-danger btn-sm btn-icon" onclick="updateStatus(${a.id},'cancelled')">Ã—</button></div></div>`).join('');
}

function showPage(p){
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    event.target.closest('.nav-item').classList.add('active');
    ['dashboard','appointments','patients','schedule','settings'].forEach(pg=>document.getElementById(pg+'Page').classList.add('hidden'));
    document.getElementById(p+'Page').classList.remove('hidden');
    if(p==='dashboard')loadStats();if(p==='appointments')loadAppointments();if(p==='patients')loadPatients();if(p==='schedule')loadBlockedSlots();
}

async function loadAppointments(){
    const date=document.getElementById('filterDate').value,status=document.getElementById('filterStatus').value;
    let url='/api/admin/appointments?';if(date)url+=`date=${date}&`;if(status)url+=`status=${status}`;
    const r=await fetch(url);const apts=await r.json();
    document.getElementById('appointmentsTable').innerHTML=apts.map(a=>`<tr><td>${formatDate(a.date)}</td><td>${a.start_time}-${a.end_time}</td><td>${a.patient_name}</td><td dir="ltr">${a.patient_phone}</td><td>${t('treatments')[a.treatment_id]||a.treatment?.name_ku}</td><td><span class="badge badge-${a.status}">${t(a.status)}</span></td><td><div style="display:flex;gap:0.3rem">${a.status==='pending'?`<button class="btn btn-success btn-sm btn-icon" onclick="updateStatus(${a.id},'confirmed')">âœ“</button>`:''}${a.status==='confirmed'?`<button class="btn btn-primary btn-sm btn-icon" onclick="updateStatus(${a.id},'completed')">âœ“</button>`:''}<button class="btn btn-danger btn-sm btn-icon" onclick="deleteAppointment(${a.id})">ğŸ—‘</button></div></td></tr>`).join('');
}

async function loadPatients(){
    const r=await fetch('/api/admin/patients');const pts=await r.json();
    document.getElementById('patientsTable').innerHTML=pts.map(p=>`<tr><td>${p.name}</td><td dir="ltr">${p.phone}</td><td>${p.total_appointments}</td><td>${p.completed_appointments}</td><td>${formatDate(p.created_at)}</td></tr>`).join('');
}

async function loadBlockedSlots(){
    const r=await fetch('/api/admin/blocked-slots');const slots=await r.json();
    document.getElementById('blockedSlotsTable').innerHTML=slots.map(s=>`<tr><td>${formatDate(s.date)}</td><td>${s.start_time}-${s.end_time}</td><td>${s.reason||'-'}</td><td><button class="btn btn-danger btn-sm btn-icon" onclick="deleteBlockedSlot(${s.id})">ğŸ—‘</button></td></tr>`).join('');
}

async function updateStatus(id,status){await fetch(`/api/admin/appointments/${id}`,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({status})});loadStats();loadAppointments();}
async function deleteAppointment(id){if(!confirm('Delete?'))return;await fetch(`/api/admin/appointments/${id}`,{method:'DELETE'});loadStats();loadAppointments();}

function openNewAppointmentModal(){document.getElementById('aptPatientName').value='';document.getElementById('aptPatientPhone').value='';document.getElementById('aptDate').value='';document.getElementById('aptTime').innerHTML='<option value="">Select date first</option>';document.getElementById('aptNotes').value='';document.getElementById('appointmentModal').classList.add('active');}

async function loadAvailableSlots(){
    const date=document.getElementById('aptDate').value,tid=document.getElementById('aptTreatment').value;
    if(!date)return;
    const r=await fetch(`/api/slots/${date}/${tid}`);const d=await r.json();
    if(!d.available||!d.slots.length){document.getElementById('aptTime').innerHTML='<option value="">No slots</option>';return;}
    document.getElementById('aptTime').innerHTML=d.slots.map(s=>`<option value="${s.start}|${s.end}">${s.display}</option>`).join('');
}

async function createAppointment(){
    const name=document.getElementById('aptPatientName').value,phone=document.getElementById('aptPatientPhone').value,tid=document.getElementById('aptTreatment').value,date=document.getElementById('aptDate').value,timeVal=document.getElementById('aptTime').value,status=document.getElementById('aptStatus').value,notes=document.getElementById('aptNotes').value;
    if(!name||!phone||!date||!timeVal)return alert('Fill all fields');
    const[st,en]=timeVal.split('|');
    const r=await fetch('/api/admin/appointments',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({patientName:name,patientPhone:phone,treatmentId:tid,date,startTime:st,endTime:en,status,notes})});
    const d=await r.json();
    if(d.success){closeModal('appointmentModal');loadStats();loadAppointments();}else alert(d.error||'Error');
}

function openBlockSlotModal(){document.getElementById('blockDate').value='';document.getElementById('blockReason').value='';document.getElementById('blockSlotModal').classList.add('active');}

async function blockSlot(){
    const date=document.getElementById('blockDate').value,st=document.getElementById('blockStartTime').value,en=document.getElementById('blockEndTime').value,reason=document.getElementById('blockReason').value;
    if(!date)return alert('Select date');
    await fetch('/api/admin/block-slot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({date,startTime:st,endTime:en,reason})});
    closeModal('blockSlotModal');loadBlockedSlots();
}

async function deleteBlockedSlot(id){if(!confirm('Delete?'))return;await fetch(`/api/admin/blocked-slots/${id}`,{method:'DELETE'});loadBlockedSlots();}

async function changePassword(){
    const cur=document.getElementById('currentPassword').value,newP=document.getElementById('newPassword').value;
    const r=await fetch('/api/admin/change-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({currentPassword:cur,newPassword:newP})});
    const d=await r.json();
    if(d.success){alert('Password changed');document.getElementById('currentPassword').value='';document.getElementById('newPassword').value='';}else alert(d.error||'Error');
}

function closeModal(id){document.getElementById(id).classList.remove('active');}
function clearFilters(){document.getElementById('filterDate').value='';document.getElementById('filterStatus').value='';loadAppointments();}

socket.on('newAppointment',loadStats);
socket.on('appointmentUpdated',()=>{loadStats();loadAppointments();});
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('active');}));
    </script>
</body>
</html>
