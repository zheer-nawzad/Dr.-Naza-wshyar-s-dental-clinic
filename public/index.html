<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú©Ù„ÛŒÙ†ÛŒÚ©ÛŒ Ø¯Ø¯Ø§Ù†ÛŒ Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#1a5653;--primary-light:#2a7a76;--primary-dark:#0f3634;--accent:#c9a962;--cream:#faf8f3;--cream-dark:#f0ece3;--text:#2d3436;--text-light:#636e72;--success:#00b894;--danger:#d63031;--shadow:0 4px 20px rgba(26,86,83,0.08)}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans Arabic',sans-serif;background:var(--cream);color:var(--text);min-height:100vh}
        body.ltr{direction:ltr}body.rtl{direction:rtl}
        .lang-switcher{display:flex;gap:0.25rem;background:rgba(255,255,255,0.15);padding:0.25rem;border-radius:10px}
        .lang-btn{padding:0.4rem 0.6rem;border:none;background:transparent;border-radius:8px;cursor:pointer;font-size:0.75rem;font-weight:500;font-family:inherit;color:white;opacity:0.8}
        .lang-btn:hover{opacity:1;background:rgba(255,255,255,0.1)}.lang-btn.active{background:rgba(255,255,255,0.25);opacity:1}
        .header{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white;padding:1.5rem 2rem}
        .header-content{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
        .header-top{display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:1rem}
        .logo{display:flex;align-items:center;gap:1rem}
        .logo-icon{width:60px;height:60px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;overflow:hidden}
        .logo-icon img{width:100%;height:100%;object-fit:cover}
        .logo-text h1{font-size:1.5rem;font-weight:600}.logo-text p{font-size:0.85rem;opacity:0.9}
        .header-info{font-size:0.9rem}.header-info p{margin-bottom:0.3rem}.header-info a{color:var(--accent);text-decoration:none}
        .main-container{max-width:900px;margin:0 auto;padding:2rem}
        .card{background:white;border-radius:20px;box-shadow:var(--shadow);padding:2rem;margin-bottom:1.5rem}
        .card-title{font-size:1.3rem;color:var(--primary);margin-bottom:1.5rem;display:flex;align-items:center;gap:0.75rem;font-weight:600}
        .login-section{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
        .form-group{margin-bottom:1.5rem}.form-group label{display:block;margin-bottom:0.5rem;font-weight:500}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:1rem;border:2px solid var(--cream-dark);border-radius:12px;font-size:1rem;font-family:inherit;background:var(--cream)}
        .form-group input:focus,.form-group select:focus{outline:none;border-color:var(--primary-light);background:white}
        .btn{padding:1rem 2rem;border:none;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;font-family:inherit;display:inline-flex;align-items:center;justify-content:center;gap:0.5rem}
        .btn-primary{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white}
        .btn-secondary{background:var(--cream);color:var(--primary);border:2px solid var(--primary)}
        .btn-accent{background:linear-gradient(135deg,var(--accent) 0%,#dfc68a 100%);color:var(--primary-dark)}
        .treatment-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem}
        .treatment-card{padding:1.25rem;border:2px solid var(--cream-dark);border-radius:16px;cursor:pointer;background:var(--cream);transition:all 0.3s}
        .treatment-card:hover,.treatment-card.selected{border-color:var(--primary);background:white}
        .treatment-name{font-weight:600;color:var(--primary-dark);margin-bottom:0.5rem}
        .treatment-duration{font-size:0.8rem;color:var(--accent)}
        .calendar-container{background:var(--cream);border-radius:16px;padding:1.5rem}
        .calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
        .calendar-nav{display:flex;gap:0.5rem}
        .calendar-nav button{width:40px;height:40px;border:none;background:white;border-radius:10px;cursor:pointer;font-size:1.2rem;color:var(--primary)}
        .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:0.5rem}
        .calendar-day-header{text-align:center;font-weight:600;color:var(--text-light);padding:0.5rem;font-size:0.7rem}
        .calendar-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:12px;cursor:pointer;font-weight:500;background:white}
        .calendar-day:hover:not(.disabled):not(.closed){background:var(--primary-light);color:white}
        .calendar-day.selected{background:var(--primary);color:white}
        .calendar-day.disabled{color:var(--cream-dark);cursor:not-allowed;background:transparent}
        .calendar-day.closed{color:var(--danger);opacity:0.5;cursor:not-allowed}
        .calendar-day.today{border:2px solid var(--accent)}
        .time-slots{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:0.75rem;margin-top:1rem}
        .time-slot{padding:1rem;text-align:center;border:2px solid var(--cream-dark);border-radius:12px;cursor:pointer;background:var(--cream);font-weight:500}
        .time-slot:hover,.time-slot.selected{border-color:var(--primary);background:var(--primary);color:white}
        .time-slot.booked{background:var(--cream-dark);border-color:var(--cream-dark);color:var(--text-light);cursor:not-allowed;opacity:0.7;display:flex;flex-direction:column;gap:0.2rem}
        .time-slot.booked small{font-size:0.7rem;color:var(--danger)}
        .status-badge{display:inline-flex;padding:0.4rem 0.8rem;border-radius:20px;font-size:0.8rem;font-weight:500}
        .status-pending{background:rgba(253,203,110,0.2);color:#d68f00}
        .status-confirmed{background:rgba(0,184,148,0.15);color:var(--success)}
        .status-completed{background:rgba(26,86,83,0.1);color:var(--primary)}
        .status-cancelled{background:rgba(214,48,49,0.1);color:var(--danger)}
        .appointment-item{display:flex;align-items:center;gap:1.5rem;padding:1.25rem;background:var(--cream);border-radius:16px;margin-bottom:1rem}
        .appointment-date{text-align:center;background:var(--primary);color:white;padding:0.75rem 1rem;border-radius:12px;min-width:80px}
        .appointment-date .day{font-size:1rem;font-weight:700}
        .appointment-details{flex:1}.appointment-treatment{font-weight:600;color:var(--primary-dark)}
        .message{padding:1rem 1.5rem;border-radius:12px;margin-bottom:1rem;display:flex;align-items:center;gap:0.75rem}
        .message-info{background:rgba(26,86,83,0.1);color:var(--primary)}
        .message-error{background:rgba(214,48,49,0.1);color:var(--danger)}
        .stepper{display:flex;justify-content:center;gap:2rem;margin-bottom:2rem}
        .step{display:flex;flex-direction:column;align-items:center;gap:0.5rem;opacity:0.4}
        .step.active,.step.completed{opacity:1}
        .step-number{width:45px;height:45px;border-radius:50%;background:var(--cream-dark);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:1.1rem}
        .step.active .step-number{background:var(--primary);color:white}
        .step.completed .step-number{background:var(--success);color:white}
        .step-label{font-size:0.85rem;color:var(--text-light)}
        .user-bar{background:linear-gradient(135deg,var(--primary-dark) 0%,var(--primary) 100%);color:white;padding:0.75rem 2rem;display:flex;justify-content:space-between;align-items:center}
        .user-info{display:flex;align-items:center;gap:1rem}
        .user-avatar{width:40px;height:40px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--primary-dark)}
        .tabs{display:flex;gap:0.5rem;margin-bottom:1.5rem}
        .tab{padding:0.75rem 1.5rem;border:none;background:var(--cream);border-radius:10px;cursor:pointer;font-weight:500;font-family:inherit;color:var(--text-light)}
        .tab.active{background:var(--primary);color:white}
        .loading{text-align:center;padding:2rem;color:var(--text-light)}
        .spinner{width:30px;height:30px;border:3px solid var(--cream-dark);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;display:inline-block;margin:0 0.5rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        .hidden{display:none!important}
        .footer{text-align:center;padding:2rem;color:var(--text-light)}.footer a{color:var(--primary);text-decoration:none}
        @media(max-width:768px){.header-content{flex-direction:column;text-align:center}.header-top{flex-direction:column;gap:1rem}.login-section{grid-template-columns:1fr}.main-container{padding:1rem}.treatment-grid{grid-template-columns:1fr}.calendar-day-header{font-size:0.6rem}}
    </style>
</head>
<body class="rtl">
    <header class="header">
        <div class="header-content">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon"><img src="/doctor.jpg" alt="Dr. Naza"></div>
                    <div class="logo-text">
                        <h1 data-i18n="doctorName">Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±</h1>
                        <p data-i18n="doctorTitle">Ù¾Ø²ÛŒØ´Ú©ÛŒ Ø¬ÙˆØ§Ù†Ú©Ø§Ø±ÛŒ Ùˆ Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ Ø¯Ø¯Ø§Ù†ÛŒ Ù…Ù†Ø§Úµ Ùˆ Ú¯Û•ÙˆØ±Û•</p>
                    </div>
                </div>
                <div class="lang-switcher">
                    <button class="lang-btn active" onclick="setLanguage('ku')">Ú©ÙˆØ±Ø¯ÛŒ</button>
                    <button class="lang-btn" onclick="setLanguage('en')">English</button>
                    <button class="lang-btn" onclick="setLanguage('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                </div>
            </div>
            <div class="header-info">
                <p>ğŸ“… <span data-i18n="schedule">Ø´Û•Ù…Û• - ÛŒÛ•Ú©Ø´Û•Ù…Û• - Ø¯ÙˆÙˆØ´Û•Ù…Û• - Ø³ÛØ´Û•Ù…Û• - Ú†ÙˆØ§Ø±Ø´Û•Ù…Û•</span></p>
                <p>ğŸ• <span data-i18n="hours">Ù¡:Ù Ù  - Ù§:Ù Ù  Ø¦ÛÙˆØ§Ø±Û•</span></p>
                <p>ğŸ“ <span data-i18n="address">Ø³Ù„ÛÙ…Ø§Ù†ÛŒØŒ Ø¨Ø§Ø²Ù†Û•ÛŒ Ù…Û•Ù„ÛŒÚ© Ù…Û•Ø­Ù…ÙˆÙˆØ¯</span></p>
                <p style="font-size:0.8rem;opacity:0.85" data-i18n="addressDetail">Ù†Ø²ÛŒÚ© Ù†Û•Ø®Û†Ø´Ø®Ø§Ù†Û•ÛŒ ÙØ§Ø±ÙˆÙ‚ØŒ Ø¨Û•Ø±Ø§Ù…Ø¨Û•Ø± Ø¨Û•Ù†Ø²ÛŒÙ†Ø®Ø§Ù†Û•ÛŒ Ø¨Ù†Ø§Ø±ÛŒ Ú¯Û†ÛŒÚ˜Û•</p>
                <a href="https://maps.app.goo.gl/eSJ9n4i2AKfho6Ug7" target="_blank">ğŸ—ºï¸ <span data-i18n="googleMaps">Ú¯Û†Ú¯Úµ Ù…Ø§Ù¾</span></a>
            </div>
        </div>
    </header>

    <div class="user-bar hidden" id="userBar">
        <div class="user-info">
            <div class="user-avatar" id="userAvatar">Ù†</div>
            <div><div id="userName"></div><div id="userPhone" style="font-size:0.85rem;opacity:0.8"></div></div>
        </div>
        <button class="btn btn-secondary" onclick="logout()" style="padding:0.5rem 1rem;font-size:0.85rem" data-i18n="logout">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
    </div>

    <main class="main-container">
        <section id="loginSection" class="card" style="display:none">
            <h2 class="card-title"><span>ğŸ‘¤</span><span data-i18n="loginTitle">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• / ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</span></h2>
            <p style="color:var(--text-light);margin-bottom:1.5rem" data-i18n="loginDesc">Ø¨Û† Ù†Û†Ø±Û•Ú¯Ø±ØªÙ†ØŒ ØªÚ©Ø§ÛŒÛ• Ù†Ø§Ùˆ Ùˆ Ú˜Ù…Ø§Ø±Û• ØªÛ•Ù„Û•ÙÛ†Ù†Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•.</p>
            <div class="login-section">
                <div class="form-group"><label data-i18n="fullName">Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ</label><input type="text" id="patientName"></div>
                <div class="form-group"><label data-i18n="phoneNumber">Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„</label><input type="tel" id="patientPhone" dir="ltr" placeholder="07XX XXX XXXX"></div>
            </div>
            <div class="form-group" style="max-width:200px"><label data-i18n="age">ØªÛ•Ù…Û•Ù†</label><input type="number" id="patientAge" min="1" max="120" placeholder="Ù¢Ù¥"></div>
            <button class="btn btn-primary" onclick="login()" style="width:100%"><span data-i18n="loginBtn">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ùˆ Ù†Û†Ø±Û•Ú©Ø±Ø¯Ù†</span></button>
        </section>

        <section id="bookingSection" class="hidden">
            <div class="tabs">
                <button class="tab active" onclick="showTab('booking')" data-i18n="newBooking">ğŸ“… Ù†Û†Ø±Û•ÛŒ Ù†ÙˆÛ</button>
                <button class="tab" onclick="showTab('appointments')" data-i18n="myBookings">ğŸ“‹ Ù†Û†Ø±Û•Ú©Ø§Ù†Ù…</button>
            </div>

            <div id="bookingTab">
                <div class="stepper">
                    <div class="step active" id="step1"><div class="step-number">Ù¡</div><div class="step-label" data-i18n="stepTreatment">Ú†Ø§Ø±Û•Ø³Û•Ø±</div></div>
                    <div class="step" id="step2"><div class="step-number">Ù¢</div><div class="step-label" data-i18n="stepDate">Ø¨Û•Ø±ÙˆØ§Ø±</div></div>
                    <div class="step" id="step3"><div class="step-number">Ù£</div><div class="step-label" data-i18n="stepTime">Ú©Ø§Øª</div></div>
                    <div class="step" id="step4"><div class="step-number">Ù¤</div><div class="step-label" data-i18n="stepConfirm">Ø¯ÙˆÙˆÙ¾Ø§Øª</div></div>
                </div>

                <div class="card" id="treatmentStep"><h2 class="card-title"><span>ğŸ¦·</span><span data-i18n="selectTreatment">Ø¬Û†Ø±ÛŒ Ú†Ø§Ø±Û•Ø³Û•Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</span></h2><div class="treatment-grid" id="treatmentGrid"></div></div>

                <div class="card hidden" id="dateStep">
                    <h2 class="card-title"><span>ğŸ“…</span><span data-i18n="selectDate">Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ù†Û†Ø±Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</span></h2>
                    <div class="message message-info"><span>â„¹ï¸</span><span data-i18n="closedDaysNote">Ú©Ù„ÛŒÙ†ÛŒÚ© Ù¾ÛÙ†Ø¬Ø´Û•Ù…Ù…Û• Ùˆ Ù‡Û•ÛŒÙ†ÛŒ Ø¯Ø§Ø®Ø±Ø§ÙˆÛ•</span></div>
                    <div class="calendar-container">
                        <div class="calendar-header"><h3 id="calendarTitle"></h3><div class="calendar-nav"><button onclick="prevMonth()" id="prevBtn">â†’</button><button onclick="nextMonth()" id="nextBtn">â†</button></div></div>
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>
                    <button class="btn btn-secondary" onclick="goToStep(1)" style="margin-top:1rem" data-i18n="back">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
                </div>

                <div class="card hidden" id="timeStep">
                    <h2 class="card-title"><span>ğŸ•</span><span data-i18n="selectTime">Ú©Ø§ØªÛŒ Ù†Û†Ø±Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</span></h2>
                    <div id="timeSlotsContainer"><div class="loading"><span class="spinner"></span><span data-i18n="loading">Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†...</span></div></div>
                    <button class="btn btn-secondary" onclick="goToStep(2)" style="margin-top:1rem" data-i18n="back">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
                </div>

                <div class="card hidden" id="confirmStep">
                    <h2 class="card-title"><span>âœ…</span><span data-i18n="confirmBooking">Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù†Û†Ø±Û•</span></h2>
                    <div style="background:var(--cream);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem">
                        <div style="display:grid;gap:1rem">
                            <div style="display:flex;justify-content:space-between;padding-bottom:0.75rem;border-bottom:1px solid var(--cream-dark)"><span data-i18n="treatment">Ú†Ø§Ø±Û•Ø³Û•Ø±:</span><span id="confirmTreatment" style="font-weight:600">-</span></div>
                            <div style="display:flex;justify-content:space-between;padding-bottom:0.75rem;border-bottom:1px solid var(--cream-dark)"><span data-i18n="date">Ø¨Û•Ø±ÙˆØ§Ø±:</span><span id="confirmDate" style="font-weight:600">-</span></div>
                            <div style="display:flex;justify-content:space-between;padding-bottom:0.75rem;border-bottom:1px solid var(--cream-dark)"><span data-i18n="time">Ú©Ø§Øª:</span><span id="confirmTime" style="font-weight:600">-</span></div>
                            <div style="display:flex;justify-content:space-between"><span data-i18n="duration">Ù…Ø§ÙˆÛ•:</span><span id="confirmDuration" style="font-weight:600">-</span></div>
                        </div>
                    </div>
                    <div class="form-group"><label data-i18n="notesLabel">ØªÛØ¨ÛŒÙ†ÛŒ (Ø¦Ø§Ø±Û•Ø²ÙˆÙˆÙ…Û•Ù†Ø¯Ø§Ù†Û•)</label><textarea id="appointmentNotes" rows="3"></textarea></div>
                    <div class="message message-info"><span>ğŸ“</span><span data-i18n="confirmNote">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø± Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØª Ù¾ÛÙˆÛ•Ø¯Û•Ú©Ø§Øª Ø¨Û† Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•</span></div>
                    <div style="display:flex;gap:1rem;margin-top:1rem">
                        <button class="btn btn-secondary" onclick="goToStep(3)" data-i18n="back">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
                        <button class="btn btn-accent" onclick="confirmBooking()" style="flex:1">âœ“ <span data-i18n="confirmBtn">Ù†Û†Ø±Û• Ø¯ÚµÙ†ÛŒØ§Ø¨Ú©Û•ÙˆÛ•</span></button>
                    </div>
                </div>
            </div>

            <div id="appointmentsTab" class="hidden">
                <div class="card"><h2 class="card-title"><span>ğŸ“‹</span><span data-i18n="myBookings">Ù†Û†Ø±Û•Ú©Ø§Ù†Ù…</span></h2><div id="appointmentsList"><div class="loading"><span class="spinner"></span></div></div></div>
            </div>
        </section>
    </main>

    <footer class="footer"><p style="margin-bottom:0.75rem"><a href="https://www.instagram.com/dr.naza_wshyar" target="_blank" style="margin:0 0.5rem;display:inline-block"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><radialGradient id="ig" cx="30%" cy="107%" r="150%"><stop offset="0%" stop-color="#fdf497"/><stop offset="5%" stop-color="#fdf497"/><stop offset="45%" stop-color="#fd5949"/><stop offset="60%" stop-color="#d6249f"/><stop offset="90%" stop-color="#285AEB"/></radialGradient><rect width="20" height="20" x="2" y="2" rx="5" fill="url(#ig)"/><circle cx="12" cy="12" r="4" stroke="white" stroke-width="2" fill="none"/><circle cx="17.5" cy="6.5" r="1.5" fill="white"/></svg></a><a href="https://www.tiktok.com/@dr.naza_wshyar" target="_blank" style="margin:0 0.5rem;display:inline-block"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="4" fill="black"/><path d="M16.5 8.5c-1.5 0-2.5-1-2.5-2.5h-2v9c0 1.4-1.1 2.5-2.5 2.5S7 16.4 7 15s1.1-2.5 2.5-2.5c.3 0 .5 0 .8.1V10c-.3 0-.5-.1-.8-.1C6.9 9.9 5 11.8 5 14.2s1.9 4.3 4.2 4.3 4.3-1.9 4.3-4.3V10c.8.6 1.8 1 3 1V8.5z" fill="#25F4EE"/><path d="M17 8c-1.5 0-2.5-1-2.5-2.5h-2v9c0 1.4-1.1 2.5-2.5 2.5S7.5 15.9 7.5 14.5 8.6 12 10 12c.3 0 .5 0 .8.1V9.5c-.3 0-.5-.1-.8-.1-2.3 0-4.2 1.9-4.2 4.3s1.9 4.3 4.2 4.3 4.3-1.9 4.3-4.3V9.5c.8.6 1.8 1 3 1V8z" fill="#FE2C55"/><path d="M16.8 8.2c-1.5 0-2.5-1-2.5-2.5h-2v9c0 1.4-1.1 2.5-2.5 2.5s-2.5-1.1-2.5-2.5 1.1-2.5 2.5-2.5c.3 0 .5 0 .8.1V9.7c-.3 0-.5-.1-.8-.1-2.3 0-4.2 1.9-4.2 4.3s1.9 4.3 4.2 4.3 4.3-1.9 4.3-4.3V9.7c.8.6 1.8 1 3 1V8.2z" fill="white"/></svg></a></p><p>Â© Ù¢Ù Ù¢Ù¥ <span data-i18n="clinicName">Ú©Ù„ÛŒÙ†ÛŒÚ©ÛŒ Ø¯Ø¯Ø§Ù†ÛŒ Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±</span></p><p style="margin-top:0.5rem;font-size:0.8rem;opacity:0.7">Ø¯ÛŒØ²Ø§ÛŒÙ† Ùˆ Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†: Ú˜ÛŒØ± Ù†Û•ÙˆØ²Ø§Ø¯</p></footer>

    <script src="/socket.io/socket.io.js"></script>
    <script>
const T = {
    ku: {
        doctorName:'Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±',doctorTitle:'Ù¾Ø²ÛŒØ´Ú©ÛŒ Ø¬ÙˆØ§Ù†Ú©Ø§Ø±ÛŒ Ùˆ Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ Ø¯Ø¯Ø§Ù†ÛŒ Ù…Ù†Ø§Úµ Ùˆ Ú¯Û•ÙˆØ±Û•',schedule:'Ø´Û•Ù…Û• - ÛŒÛ•Ú©Ø´Û•Ù…Û• - Ø¯ÙˆÙˆØ´Û•Ù…Û• - Ø³ÛØ´Û•Ù…Û• - Ú†ÙˆØ§Ø±Ø´Û•Ù…Û•',hours:'Ù¡:Ù Ù  - Ù§:Ù Ù  Ø¦ÛÙˆØ§Ø±Û•',address:'Ø³Ù„ÛÙ…Ø§Ù†ÛŒØŒ Ø¨Ø§Ø²Ù†Û•ÛŒ Ù…Û•Ù„ÛŒÚ© Ù…Û•Ø­Ù…ÙˆÙˆØ¯',addressDetail:'Ù†Ø²ÛŒÚ© Ù†Û•Ø®Û†Ø´Ø®Ø§Ù†Û•ÛŒ ÙØ§Ø±ÙˆÙ‚ØŒ Ø¨Û•Ø±Ø§Ù…Ø¨Û•Ø± Ø¨Û•Ù†Ø²ÛŒÙ†Ø®Ø§Ù†Û•ÛŒ Ø¨Ù†Ø§Ø±ÛŒ Ú¯Û†ÛŒÚ˜Û•',googleMaps:'Ú¯Û†Ú¯Úµ Ù…Ø§Ù¾',
        loginTitle:'Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• / ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†',loginDesc:'Ø¨Û† Ù†Û†Ø±Û•Ú¯Ø±ØªÙ†ØŒ ØªÚ©Ø§ÛŒÛ• Ù†Ø§Ùˆ Ùˆ Ú˜Ù…Ø§Ø±Û• ØªÛ•Ù„Û•ÙÛ†Ù†Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•.',fullName:'Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ',phoneNumber:'Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„',age:'ØªÛ•Ù…Û•Ù†',loginBtn:'Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ùˆ Ù†Û†Ø±Û•Ú©Ø±Ø¯Ù†',logout:'Ø¯Û•Ø±Ú†ÙˆÙˆÙ†',
        newBooking:'ğŸ“… Ù†Û†Ø±Û•ÛŒ Ù†ÙˆÛ',myBookings:'ğŸ“‹ Ù†Û†Ø±Û•Ú©Ø§Ù†Ù…',stepTreatment:'Ú†Ø§Ø±Û•Ø³Û•Ø±',stepDate:'Ø¨Û•Ø±ÙˆØ§Ø±',stepTime:'Ú©Ø§Øª',stepConfirm:'Ø¯ÙˆÙˆÙ¾Ø§Øª',
        selectTreatment:'Ø¬Û†Ø±ÛŒ Ú†Ø§Ø±Û•Ø³Û•Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•',selectDate:'Ø¨Û•Ø±ÙˆØ§Ø±ÛŒ Ù†Û†Ø±Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•',selectTime:'Ú©Ø§ØªÛŒ Ù†Û†Ø±Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•',closedDaysNote:'Ú©Ù„ÛŒÙ†ÛŒÚ© Ù¾ÛÙ†Ø¬Ø´Û•Ù…Ù…Û• Ùˆ Ù‡Û•ÛŒÙ†ÛŒ Ø¯Ø§Ø®Ø±Ø§ÙˆÛ•',back:'Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•',
        confirmBooking:'Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù†Û†Ø±Û•',treatment:'Ú†Ø§Ø±Û•Ø³Û•Ø±:',date:'Ø¨Û•Ø±ÙˆØ§Ø±:',time:'Ú©Ø§Øª:',duration:'Ù…Ø§ÙˆÛ•:',notesLabel:'ØªÛØ¨ÛŒÙ†ÛŒ (Ø¦Ø§Ø±Û•Ø²ÙˆÙˆÙ…Û•Ù†Ø¯Ø§Ù†Û•)',confirmNote:'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø± Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØª Ù¾ÛÙˆÛ•Ø¯Û•Ú©Ø§Øª Ø¨Û† Ø¯ÚµÙ†ÛŒØ§Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•',confirmBtn:'Ù†Û†Ø±Û• Ø¯ÚµÙ†ÛŒØ§Ø¨Ú©Û•ÙˆÛ•',
        loading:'Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†...',noBookings:'Ù‡ÛŒÚ† Ù†Û†Ø±Û•ÛŒÛ•Ú©Øª Ù†ÛŒÛŒÛ•',noSlots:'Ù‡ÛŒÚ† Ú©Ø§ØªÛÚ©ÛŒ Ø¨Û•Ø±Ø¯Û•Ø³Øª Ù†ÛŒÛŒÛ•',booked:'Ù†Û†Ø±Û•Ú©Ø±Ø§ÙˆÛ•',clinicName:'Ú©Ù„ÛŒÙ†ÛŒÚ©ÛŒ Ø¯Ø¯Ø§Ù†ÛŒ Ø¯. Ù†Ø§Ø²Û• ÙˆØ´ÛŒØ§Ø±',admin:'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ',minutes:'Ø®ÙˆÙ„Û•Ú©',
        bookingSuccess:'Ù†Û†Ø±Û•Ú©Û•Øª Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§!',fillFields:'ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú•Ø¨Ú©Û•ÙˆÛ•',
        pending:'â³ Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†',confirmed:'âœ“ Ù¾Ø´ØªÚ•Ø§Ø³Øª',completed:'âœ“ ØªÛ•ÙˆØ§Ùˆ',cancelled:'âœ— Ù‡Û•ÚµÙˆÛ•Ø´Ø§',
        days:['Ø´Û•Ù…Û•','Ù¡ Ø´Û•Ù…Û•','Ù¢ Ø´Û•Ù…Û•','Ù£ Ø´Û•Ù…Û•','Ù¤ Ø´Û•Ù…Û•','Ù¥ Ø´Û•Ù…Û•','Ù‡Û•ÛŒÙ†ÛŒ'],
        treatments:{1:'Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Ø¦Ø§Ø³Ø§ÛŒÛŒ',2:'Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Ø¯Ø§Ù†',3:'Ù¾Ú•Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Ø¯Ø§Ù†',4:'Ø¯Ø¯Ø§Ù† Ú©Ø´Ø§Ù†',5:'Ø¯Û•Ù…Ø§Ø± Ø¨Ú•ÛŒÙ†',6:'Ú©ÛŒÙÛŒ Ø¯Ø¯Ø§Ù†',7:'Ø³Ù¾ÛŒÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Ø¯Ø§Ù†',8:'ØªÛŒØ´Ú©ÛŒ Ø¯Ø¯Ø§Ù†',9:'Ú•Ø§ÙˆÛÚ˜ÛŒ Ú†Ø§Ù†Ø¯Ù†ÛŒ Ø¯Ø¯Ø§Ù†',10:'Ù¾ÙˆÙˆÚ© Ø¨Ú•ÛŒÙ† Ø¨Û† Ø¬ÙˆØ§Ù†Ú©Ø§Ø±ÛŒ'}
    },
    en: {
        doctorName:'Dr. Naza Wshyar',doctorTitle:'Family Dentist',schedule:'Saturday - Sunday - Monday - Tuesday - Wednesday',hours:'1:00 - 7:00 PM',address:'Sulaymaniyah, Malik Mahmood Circle',addressDetail:'Near Farooq Hospital, Opposite Bnari Goizha Gas Station',googleMaps:'Google Maps',
        loginTitle:'Login / Register',loginDesc:'To book an appointment, please enter your name and phone number.',fullName:'Full Name',phoneNumber:'Phone Number',age:'Age',loginBtn:'Login & Book',logout:'Logout',
        newBooking:'ğŸ“… New Booking',myBookings:'ğŸ“‹ My Bookings',stepTreatment:'Treatment',stepDate:'Date',stepTime:'Time',stepConfirm:'Confirm',
        selectTreatment:'Select Treatment Type',selectDate:'Select Appointment Date',selectTime:'Select Appointment Time',closedDaysNote:'Clinic is closed on Thursday and Friday',back:'Back',
        confirmBooking:'Confirm Appointment',treatment:'Treatment:',date:'Date:',time:'Time:',duration:'Duration:',notesLabel:'Notes (Optional)',confirmNote:'Admin will call you to confirm',confirmBtn:'Confirm Booking',
        loading:'Loading...',noBookings:'No appointments yet',noSlots:'No time slots available',booked:'Booked',clinicName:'Dr. Naza Wshyar Dental Clinic',admin:'Administration',minutes:'min',
        bookingSuccess:'Your appointment has been booked!',fillFields:'Please fill all fields',
        pending:'â³ Pending',confirmed:'âœ“ Confirmed',completed:'âœ“ Completed',cancelled:'âœ— Cancelled',
        days:['Sat','Sun','Mon','Tue','Wed','Thu','Fri'],
        treatments:{1:'Regular Checkup',2:'Teeth Cleaning',3:'Tooth Filling',4:'Tooth Extraction',5:'Root Canal',6:'Dental Crown',7:'Teeth Whitening',8:'Dental X-Ray',9:'Dental Implant Consultation',10:'Gum Treatment'}
    },
    ar: {
        doctorName:'Ø¯. Ù†Ø§Ø²Ù‡ ÙˆØ´ÛŒØ§Ø±',doctorTitle:'Ø·Ø¨ÙŠØ¨Ø© Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©',schedule:'Ø§Ù„Ø³Ø¨Øª - Ø§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† - Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ - Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡',hours:'Ù¡:Ù Ù  - Ù§:Ù Ù  Ù…Ø³Ø§Ø¡Ù‹',address:'Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©ØŒ Ø¯ÙˆØ§Ø± Ù…Ø§Ù„Ùƒ Ù…Ø­Ù…ÙˆØ¯',addressDetail:'Ù‚Ø±Ø¨ Ù…Ø³ØªØ´ÙÙ‰ ÙØ§Ø±ÙˆÙ‚ØŒ Ù…Ù‚Ø§Ø¨Ù„ Ù…Ø­Ø·Ø© Ø¨Ù†Ø§Ø±ÙŠ Ú¯ÙˆÛŒÚ˜Û•',googleMaps:'Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„',
        loginTitle:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„ØªØ³Ø¬ÙŠÙ„',loginDesc:'Ù„Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ±Ù‚Ù… Ù‡Ø§ØªÙÙƒ.',fullName:'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„',phoneNumber:'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ',age:'Ø§Ù„Ø¹Ù…Ø±',loginBtn:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø­Ø¬Ø²',logout:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
        newBooking:'ğŸ“… Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯',myBookings:'ğŸ“‹ Ø­Ø¬ÙˆØ²Ø§ØªÙŠ',stepTreatment:'Ø§Ù„Ø¹Ù„Ø§Ø¬',stepDate:'Ø§Ù„ØªØ§Ø±ÙŠØ®',stepTime:'Ø§Ù„ÙˆÙ‚Øª',stepConfirm:'ØªØ£ÙƒÙŠØ¯',
        selectTreatment:'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù„Ø§Ø¬',selectDate:'Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯',selectTime:'Ø§Ø®ØªØ± ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯',closedDaysNote:'Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ù…ØºÙ„Ù‚Ø© ÙŠÙˆÙ…ÙŠ Ø§Ù„Ø®Ù…ÙŠØ³ ÙˆØ§Ù„Ø¬Ù…Ø¹Ø©',back:'Ø±Ø¬ÙˆØ¹',
        confirmBooking:'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯',treatment:'Ø§Ù„Ø¹Ù„Ø§Ø¬:',date:'Ø§Ù„ØªØ§Ø±ÙŠØ®:',time:'Ø§Ù„ÙˆÙ‚Øª:',duration:'Ø§Ù„Ù…Ø¯Ø©:',notesLabel:'Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',confirmNote:'Ø³ÙŠØªØµÙ„ Ø¨Ùƒ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù„ØªØ£ÙƒÙŠØ¯',confirmBtn:'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²',
        loading:'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...',noBookings:'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯',noSlots:'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆÙ‚Ø§Øª Ù…ØªØ§Ø­Ø©',booked:'Ù…Ø­Ø¬ÙˆØ²',clinicName:'Ø¹ÙŠØ§Ø¯Ø© Ø¯. Ù†Ø§Ø²Ù‡ ÙˆØ´ÛŒØ§Ø± Ù„Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',admin:'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',minutes:'Ø¯Ù‚ÙŠÙ‚Ø©',
        bookingSuccess:'ØªÙ… Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø¨Ù†Ø¬Ø§Ø­!',fillFields:'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„',
        pending:'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',confirmed:'âœ“ Ù…Ø¤ÙƒØ¯',completed:'âœ“ Ù…ÙƒØªÙ…Ù„',cancelled:'âœ— Ù…Ù„ØºÙŠ',
        days:['Ø§Ù„Ø³Ø¨Øª','Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©'],
        treatments:{1:'ÙØ­Øµ Ø¹Ø§Ù…',2:'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',3:'Ø­Ø´Ùˆ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',4:'Ø®Ù„Ø¹ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',5:'Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¹ØµØ¨',6:'ØªØ§Ø¬ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',7:'ØªØ¨ÙŠÙŠØ¶ Ø§Ù„Ø£Ø³Ù†Ø§Ù†',8:'Ø£Ø´Ø¹Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†',9:'Ø§Ø³ØªØ´Ø§Ø±Ø© Ø²Ø±Ø§Ø¹Ø©',10:'Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù„Ø«Ø©'}
    }
};

let lang='ku',treatments=[],selectedTreatment=null,selectedDate=null,selectedSlot=null,currentMonth=new Date();
const socket=io();

function t(k){return T[lang][k]||k}

function formatDate(ds){
    const d=new Date(ds);
    const day=String(d.getDate()).padStart(2,'0');
    const month=String(d.getMonth()+1).padStart(2,'0');
    const year=d.getFullYear();
    return day+'.'+month+'.'+year;
}

// Convert 24h to 12h format
function to12Hour(time24){
    const [h,m]=time24.split(':');
    let hour=parseInt(h);
    if(hour===0) hour=12;
    else if(hour>12) hour-=12;
    return hour+':'+m;
}

function setLanguage(l){
    lang=l;localStorage.setItem('lang',l);
    document.body.classList.remove('ltr','rtl');
    document.body.classList.add(l==='en'?'ltr':'rtl');
    document.documentElement.dir=l==='en'?'ltr':'rtl';
    document.querySelectorAll('.lang-btn').forEach(b=>b.classList.toggle('active',b.textContent.includes(l==='ku'?'Ú©ÙˆØ±Ø¯ÛŒ':l==='en'?'English':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©')));
    document.querySelectorAll('[data-i18n]').forEach(el=>el.textContent=t(el.dataset.i18n));
    document.getElementById('prevBtn').textContent=l==='en'?'â†':'â†’';
    document.getElementById('nextBtn').textContent=l==='en'?'â†’':'â†';
    if(treatments.length)renderTreatments();
    renderCalendar();
}

document.addEventListener('DOMContentLoaded',()=>{
    setLanguage(localStorage.getItem('lang')||'ku');
    loadTreatments();
    checkAuth();
});

async function checkAuth(){
    try{
        const r=await fetch('/api/patient/check');
        const d=await r.json();
        // Remove initial inline style
        document.getElementById('loginSection').style.display='';
        
        if(d.authenticated){
            document.getElementById('userName').textContent=d.name;
            document.getElementById('userPhone').textContent=d.phone;
            document.getElementById('userAvatar').textContent=d.name[0];
            document.getElementById('userBar').classList.remove('hidden');
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('bookingSection').classList.remove('hidden');
        }else{
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('bookingSection').classList.add('hidden');
        }
    }catch(e){
        document.getElementById('loginSection').style.display='';
        document.getElementById('loginSection').classList.remove('hidden');
        document.getElementById('bookingSection').classList.add('hidden');
    }
}

async function loadTreatments(){const r=await fetch('/api/treatments');treatments=await r.json();renderTreatments();}

function renderTreatments(){
    document.getElementById('treatmentGrid').innerHTML=treatments.map(tr=>`<div class="treatment-card" onclick="selectTreatment(${tr.id})"><div class="treatment-name">${t('treatments')[tr.id]||tr.name_ku}</div><div style="font-size:0.85rem;color:var(--text-light);margin-bottom:0.5rem">${tr.name_en}</div><div class="treatment-duration">â± ${tr.duration} ${t('minutes')}</div></div>`).join('');
}

async function login(){
    const name=document.getElementById('patientName').value.trim(),phone=document.getElementById('patientPhone').value.trim(),age=document.getElementById('patientAge').value;
    if(!name||!phone||!age)return alert(t('fillFields'));
    const r=await fetch('/api/patient/auth',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone,name,age:parseInt(age)})});
    const d=await r.json();
    if(d.success){document.getElementById('userName').textContent=name;document.getElementById('userPhone').textContent=phone;document.getElementById('userAvatar').textContent=name[0];document.getElementById('userBar').classList.remove('hidden');document.getElementById('loginSection').classList.add('hidden');document.getElementById('bookingSection').classList.remove('hidden');}
}

async function logout(){
    await fetch('/api/patient/logout',{method:'POST'});
    document.getElementById('userBar').classList.add('hidden');
    document.getElementById('loginSection').classList.remove('hidden');
    document.getElementById('bookingSection').classList.add('hidden');
    resetBooking();
}

function showTab(tab){
    document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',i===(tab==='booking'?0:1)));
    document.getElementById('bookingTab').classList.toggle('hidden',tab!=='booking');
    document.getElementById('appointmentsTab').classList.toggle('hidden',tab==='booking');
    if(tab!=='booking')loadMyAppointments();
}

function selectTreatment(id){selectedTreatment=treatments.find(t=>t.id===id);document.querySelectorAll('.treatment-card').forEach((c,i)=>c.classList.toggle('selected',treatments[i].id===id));setTimeout(()=>goToStep(2),300);}

function goToStep(s){
    for(let i=1;i<=4;i++){const e=document.getElementById('step'+i);e.classList.remove('active','completed');if(i<s)e.classList.add('completed');if(i===s)e.classList.add('active');}
    document.getElementById('treatmentStep').classList.toggle('hidden',s!==1);
    document.getElementById('dateStep').classList.toggle('hidden',s!==2);
    document.getElementById('timeStep').classList.toggle('hidden',s!==3);
    document.getElementById('confirmStep').classList.toggle('hidden',s!==4);
    if(s===2)renderCalendar();if(s===4)renderConfirmation();
}

function renderCalendar(){
    const y=currentMonth.getFullYear(),m=currentMonth.getMonth();
    document.getElementById('calendarTitle').textContent=(m+1)+' / '+y;
    const fd=new Date(y,m,1),ld=new Date(y,m+1,0),sd=fd.getDay(),td=ld.getDate();
    const today=new Date();today.setHours(0,0,0,0);
    
    // Days start from Saturday (index 6 in JS)
    const dayOrder=[6,0,1,2,3,4,5]; // Sat,Sun,Mon,Tue,Wed,Thu,Fri
    let h=dayOrder.map(i=>`<div class="calendar-day-header">${t('days')[dayOrder.indexOf(i)]}</div>`).join('');
    
    // Adjust starting day for Saturday-first calendar
    let adjustedStart=(sd+1)%7;
    
    for(let i=0;i<adjustedStart;i++)h+='<div class="calendar-day disabled"></div>';
    for(let d=1;d<=td;d++){
        const dt=new Date(y,m,d);
        // Format date as YYYY-MM-DD without timezone conversion
        const ds=y+'-'+String(m+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
        const dw=dt.getDay();
        const closed=dw===4||dw===5,past=dt<today,isToday=dt.getTime()===today.getTime(),sel=selectedDate===ds;
        let cls='calendar-day';if(past)cls+=' disabled';else if(closed)cls+=' closed';if(isToday)cls+=' today';if(sel)cls+=' selected';
        h+=`<div class="${cls}" ${!past&&!closed?`onclick="selectDate('${ds}')"`:``}>${d}</div>`;
    }
    document.getElementById('calendarGrid').innerHTML=h;
}

function prevMonth(){currentMonth.setMonth(currentMonth.getMonth()-1);renderCalendar();}
function nextMonth(){currentMonth.setMonth(currentMonth.getMonth()+1);renderCalendar();}

async function selectDate(ds){selectedDate=ds;renderCalendar();await loadTimeSlots();goToStep(3);}

async function loadTimeSlots(){
    document.getElementById('timeSlotsContainer').innerHTML=`<div class="loading"><span class="spinner"></span>${t('loading')}</div>`;
    const r=await fetch(`/api/slots/${selectedDate}/${selectedTreatment.id}?showAll=true`);const d=await r.json();
    if(!d.slots||!d.slots.length){document.getElementById('timeSlotsContainer').innerHTML=`<div class="message message-error">âŒ ${t('noSlots')}</div>`;return;}
    document.getElementById('timeSlotsContainer').innerHTML=`<div class="time-slots">${d.slots.map(s=>s.booked?`<div class="time-slot booked"><span>${to12Hour(s.start)} - ${to12Hour(s.end)}</span><small>${t('booked')}</small></div>`:`<div class="time-slot" onclick="selectSlot('${s.start}','${s.end}')">${to12Hour(s.start)} - ${to12Hour(s.end)}</div>`).join('')}</div>`;
}

function selectSlot(st,en){selectedSlot={start:st,end:en};document.querySelectorAll('.time-slot').forEach(s=>s.classList.remove('selected'));event.target.classList.add('selected');setTimeout(()=>goToStep(4),300);}

function renderConfirmation(){
    document.getElementById('confirmTreatment').textContent=t('treatments')[selectedTreatment.id]||selectedTreatment.name_ku;
    document.getElementById('confirmDate').textContent=formatDate(selectedDate);
    document.getElementById('confirmTime').textContent=to12Hour(selectedSlot.start)+' - '+to12Hour(selectedSlot.end);
    document.getElementById('confirmDuration').textContent=selectedTreatment.duration+' '+t('minutes');
}

async function confirmBooking(){
    const notes=document.getElementById('appointmentNotes').value;
    try{
        const r=await fetch('/api/appointments',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({treatmentId:selectedTreatment.id,date:selectedDate,startTime:selectedSlot.start,endTime:selectedSlot.end,notes})});
        const d=await r.json();
        if(d.success){alert(t('bookingSuccess'));resetBooking();showTab('appointments');document.querySelectorAll('.tab')[1].classList.add('active');document.querySelectorAll('.tab')[0].classList.remove('active');}
        else{alert(d.error||'Error booking appointment');}
    }catch(e){alert('Connection error: '+e.message);}
}

function resetBooking(){selectedTreatment=null;selectedDate=null;selectedSlot=null;document.querySelectorAll('.treatment-card').forEach(c=>c.classList.remove('selected'));document.getElementById('appointmentNotes').value='';goToStep(1);}

async function loadMyAppointments(){
    const r=await fetch('/api/patient/appointments');const apts=await r.json();
    if(!apts.length){document.getElementById('appointmentsList').innerHTML=`<div style="text-align:center;padding:2rem;color:var(--text-light)"><p style="font-size:3rem">ğŸ“…</p><p>${t('noBookings')}</p></div>`;return;}
    document.getElementById('appointmentsList').innerHTML=apts.map(a=>`<div class="appointment-item"><div class="appointment-date"><div class="day">${formatDate(a.date)}</div></div><div class="appointment-details"><div class="appointment-treatment">${t('treatments')[a.treatment_id]||a.treatment?.name_ku}</div><div style="color:var(--text-light);font-size:0.9rem">${to12Hour(a.start_time)} - ${to12Hour(a.end_time)}</div></div><span class="status-badge status-${a.status}">${t(a.status)}</span></div>`).join('');
}

socket.on('appointmentUpdated',()=>{if(!document.getElementById('appointmentsTab').classList.contains('hidden'))loadMyAppointments();});
    </script>
</body>
</html>
